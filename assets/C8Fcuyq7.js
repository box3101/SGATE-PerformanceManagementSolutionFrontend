import Z from"./tqox-36k.js";import w from"./CUzBmAwz.js";import{_ as ee,r as I,z as q,a2 as te,c as i,o as a,a as t,k as c,I as O,t as r,C as z,b as k,w as G,x as V,d as C,F,g as J,m as P,n as le}from"./BIOxHmLM.js";import"./wOyE7Hxr.js";const ne={class:"section-header"},oe={class:"flex items-center justify-between gap-5"},ae={class:"flex items-center gap-10"},se={class:"heading-4"},ie={class:"flex items-center gap-5"},de={key:0,class:"table-actions"},re={class:"button-group flex items-center gap-5"},ue={key:0,class:"sort-mode-message"},ce={key:1,class:"empty-state"},pe={class:"empty-content"},ge={class:"empty-title"},ye={class:"empty-description"},ve={key:0,class:"empty-actions"},fe={key:2,class:"table-scroll-container"},me={class:"competency-table"},he={class:"sticky-header"},be=["draggable","onDragstart","onDrop","onClick"],xe=["rowspan"],ke=["rowspan"],Ve={key:0,class:"definition-content"},Ge={key:1,class:"category-content"},De=["rowspan"],Ce={class:"pd-trl10 br behavior-cell"},Se={class:"text-center"},Ie={class:"text-center"},_e=["rowspan"],Be={key:3,class:"competency-table"},Te={class:"sticky-header"},qe=["draggable","onDragstart","onDrop","onClick"],ze=["rowspan"],He=["rowspan"],Ke={key:0,class:"definition-content"},Ee={key:1,class:"category-content"},Ae=["rowspan"],Ne={class:"pd-trl10 br behavior-cell"},Re={class:"text-center"},Ue={class:"text-center"},$e=["rowspan"],je={__name:"CompetencyGroupTable",props:{title:{type:String,default:"역량항목 구분"},modelValue:{type:Array,default:()=>[]},bordered:{type:Boolean,default:!0},striped:{type:Boolean,default:!0},hover:{type:Boolean,default:!0},scrollable:{type:Boolean,default:!1},maxHeight:{type:String,default:"calc(100vh - 200px)"},editable:{type:Boolean,default:!0},canAddRow:{type:Boolean,default:!0},canSort:{type:Boolean,default:!0},canSave:{type:Boolean,default:!0},emptyTitle:{type:String,default:"역량 데이터가 없습니다"},emptyDescription:{type:String,default:"새로운 역량 그룹을 추가해주세요."}},emits:["update:modelValue","group-added","items-deleted","item-edited","order-changed","save"],setup(d,{emit:Q}){const f=Q,y=d,p=I([]),g=I(!1),D=I(!1),m=I(null),H=q(()=>!y.modelValue||y.modelValue.length===0),v=q(()=>{const n=[];return y.modelValue.forEach((e,s)=>{e.type==="group"?e.behaviors.forEach((o,l)=>{n.push({uniqueKey:`${e.id}_${l}`,originalGroupIndex:s,groupId:e.id,behaviorIndex:l,type:l===0?"group-header":"group-item",isGroupHeader:l===0,competencyName:e.competencyName,definition:e.definition,categoryType:e.category,behavior:o.behavior,level:o.level,weight:o.weight,totalGroupSize:e.behaviors.length,originalGroup:e,originalBehavior:o})}):n.push({uniqueKey:e.id,originalGroupIndex:s,type:"single",isGroupHeader:!1,category:e.category,categoryType:e.categoryType||e.type,behavior:e.behavior,level:e.level,weight:e.weight,totalGroupSize:1,originalGroup:e})}),n}),_=q(()=>{if(v.value.length===0)return!1;const n=v.value.filter(e=>e.isGroupHeader||e.type==="single");return n.length>0&&n.every(e=>p.value.includes(e.uniqueKey))}),h=(n,e)=>{if(n.type==="single")return!0;switch(e){case"checkbox":case"definition":case"type":case"actions":return n.isGroupHeader;default:return!0}},b=(n,e)=>{if(n.type==="single"||!n.isGroupHeader)return 1;switch(e){case"checkbox":case"definition":case"type":case"actions":return n.totalGroupSize;default:return 1}},K=n=>{const e=[];return n.type==="group-header"?e.push("group-header"):n.type==="group-item"?e.push("group-item"):e.push("single-item"),B(n)&&e.push("selected"),e.join(" ")},E=n=>{switch(n){case"핵심역량":return"category-core";case"직무역량":return"category-job";default:return"category-default"}},S=n=>g.value?n.isGroupHeader||n.type==="single":!1,B=n=>p.value.includes(n.uniqueKey),T=n=>{if(g.value||!n.isGroupHeader&&n.type!=="single")return;const e=p.value.indexOf(n.uniqueKey);e===-1?p.value.push(n.uniqueKey):p.value.splice(e,1)},A=()=>{_.value?p.value=[]:p.value=v.value.filter(n=>n.isGroupHeader||n.type==="single").map(n=>n.uniqueKey)},N=()=>{const n={id:`group_${Date.now()}`,type:"group",competencyName:"새 역량",definition:"새로운 역량 정의를 입력하세요.",category:"BARS",behaviors:[{behavior:"새로운 행동 기준을 입력하세요.",level:"3/60",weight:"10"}],sortOrder:y.modelValue.length+1},e=[...y.modelValue,n];f("update:modelValue",e),f("group-added",n)},W=()=>{if(p.value.length===0)return;const n=[],e=[...y.modelValue];p.value.forEach(s=>{const o=v.value.find(l=>l.uniqueKey===s);o&&(o.type==="group-header"?n.push({type:"group",groupIndex:o.originalGroupIndex,data:o.originalGroup}):o.type==="single"&&n.push({type:"single",groupIndex:o.originalGroupIndex,data:o.originalGroup}))}),n.sort((s,o)=>o.groupIndex-s.groupIndex).forEach(s=>{e.splice(s.groupIndex,1)}),f("update:modelValue",e),f("items-deleted",n),p.value=[]},R=n=>{f("item-edited",n)},U=(n,e)=>{e.target.closest(".ui-checkbox")||e.target.closest("button")||y.editable&&(n.isGroupHeader||n.type==="single")&&T(n)},X=()=>{g.value=!g.value,g.value||(p.value=[])},$=(n,e,s)=>{var o;if(!g.value||!S(s))return n.preventDefault(),!1;m.value=e,D.value=!0,n.dataTransfer.effectAllowed="move",(o=n.target.closest("tr"))==null||o.classList.add("dragging-source")},j=n=>{g.value&&(n.preventDefault(),n.dataTransfer.dropEffect="move")},L=(n,e)=>{if(!g.value||m.value===null)return;n.preventDefault();const s=v.value[m.value],o=v.value[e];if(m.value===e){m.value=null,D.value=!1;return}if(!S(s)||!S(o)){m.value=null,D.value=!1;return}const l=[...y.modelValue],x=l[s.originalGroupIndex];l.splice(s.originalGroupIndex,1);const u=s.originalGroupIndex<o.originalGroupIndex?o.originalGroupIndex-1:o.originalGroupIndex;l.splice(u,0,x),f("update:modelValue",l),f("order-changed",{from:s.originalGroupIndex,to:u,item:x}),m.value=null,D.value=!1},M=()=>{m.value=null,D.value=!1,document.querySelectorAll(".dragging-source").forEach(n=>{n.classList.remove("dragging-source")})},Y=()=>{f("save",y.modelValue),g.value=!1};return te(()=>y.modelValue,()=>{p.value=p.value.filter(n=>v.value.some(e=>e.uniqueKey===n))},{deep:!0}),(n,e)=>{const s=Z,o=w;return a(),i("div",{class:V(["competency-group-table-wrapper",[d.bordered&&"bordered",d.striped&&"striped",d.hover&&"hover",d.scrollable&&"scrollable",D.value&&"dragging",d.editable&&"editable"]]),style:le(d.scrollable?{maxHeight:d.maxHeight}:{})},[t("div",ne,[t("div",oe,[t("div",ae,[t("h2",se,r(d.title),1),O(n.$slots,"header-action-left",{},void 0,!0)]),t("div",ie,[O(n.$slots,"header-action-right",{},void 0,!0),d.editable?(a(),i("div",de,[t("div",re,[d.canAddRow?(a(),z(s,{key:0,type:"button",variant:"secondary-line","icon-only":"",onClick:N,title:"그룹 추가"},{default:G(()=>e[2]||(e[2]=[t("i",{class:"icon-md icon-plus icon-black"},null,-1)])),_:1})):c("",!0),k(s,{type:"button",variant:"secondary-line","icon-only":"",onClick:W,disabled:p.value.length===0,title:"선택 항목 삭제"},{default:G(()=>e[3]||(e[3]=[t("i",{class:"icon-md icon-delete"},null,-1)])),_:1},8,["disabled"]),d.canSort?(a(),z(s,{key:1,type:"button",variant:"secondary-line","icon-only":"",onClick:X,class:V({active:g.value}),title:"정렬 모드"},{default:G(()=>e[4]||(e[4]=[t("i",{class:"icon-md icon-sort"},null,-1)])),_:1},8,["class"])):c("",!0),d.canSave?(a(),z(s,{key:2,type:"button",variant:"primary",onClick:Y},{default:G(()=>e[5]||(e[5]=[C(" 저장 ")])),_:1})):c("",!0)])])):c("",!0)])])]),g.value&&d.editable?(a(),i("div",ue,e[6]||(e[6]=[C(" 그룹 헤더를 드래그하여 순서를 변경할 수 있습니다. "),t("br",null,null,-1),C("완료 후 정렬 버튼을 다시 클릭하세요. ")]))):c("",!0),H.value?(a(),i("div",ce,[t("div",pe,[e[8]||(e[8]=t("div",{class:"empty-icon"},[t("i",{class:"icon-xxl icon-table"})],-1)),t("h3",ge,r(d.emptyTitle),1),t("p",ye,r(d.emptyDescription),1),d.editable&&d.canAddRow?(a(),i("div",ve,[k(s,{variant:"primary",onClick:N},{default:G(()=>e[7]||(e[7]=[t("i",{class:"icon-sm icon-plus"},null,-1),C(" 첫 번째 그룹 추가 ")])),_:1})])):c("",!0)])])):d.scrollable?(a(),i("div",fe,[t("table",me,[e[17]||(e[17]=t("colgroup",null,[t("col",{style:{width:"40px"}}),t("col",{style:{width:"200px"}}),t("col",{style:{width:"100px"}}),t("col",{style:{width:"auto"}}),t("col",{style:{width:"100px"}}),t("col",{style:{width:"100px"}}),t("col",{style:{width:"40px"}})],-1)),t("thead",he,[t("tr",null,[t("th",null,[k(o,{size:"large",modelValue:_.value,"onUpdate:modelValue":A},null,8,["modelValue"])]),e[9]||(e[9]=t("th",null,"역량정의/역량항목",-1)),e[10]||(e[10]=t("th",null,"구분",-1)),e[11]||(e[11]=t("th",null,"행동기준/행동수준/역량정의",-1)),e[12]||(e[12]=t("th",null,"수준/점수",-1)),e[13]||(e[13]=t("th",null,"가중",-1)),e[14]||(e[14]=t("th",null,"수정",-1))])]),t("tbody",null,[(a(!0),i(F,null,J(v.value,(l,x)=>(a(),i("tr",{key:l.uniqueKey,class:V(K(l)),draggable:S(l),onDragstart:u=>$(u,x,l),onDragover:j,onDrop:u=>L(u,x),onDragend:M,onClick:u=>U(l,u)},[h(l,"checkbox")?(a(),i("td",{key:0,rowspan:b(l,"checkbox"),class:"text-center"},[k(o,{size:"large",modelValue:B(l),"onUpdate:modelValue":()=>T(l),onClick:e[0]||(e[0]=P(()=>{},["stop"]))},null,8,["modelValue","onUpdate:modelValue"])],8,xe)):c("",!0),h(l,"definition")?(a(),i("td",{key:1,rowspan:b(l,"definition"),class:"vertical-middle"},[l.type==="group-header"?(a(),i("div",Ve,[t("strong",null,"["+r(l.competencyName)+"]",1),e[15]||(e[15]=t("br",null,null,-1)),C(" "+r(l.definition),1)])):(a(),i("div",Ge,[t("span",{class:V(["category-badge",E(l.category)])},r(l.category),3)]))],8,ke)):c("",!0),h(l,"type")?(a(),i("td",{key:2,rowspan:b(l,"type"),class:"text-center"},r(l.categoryType),9,De)):c("",!0),t("td",Ce,[t("div",{class:V(l.type==="group-item"?"behavior-group":"behavior-single")},r(l.behavior),3)]),t("td",Se,r(l.level),1),t("td",Ie,r(l.weight),1),h(l,"actions")?(a(),i("td",{key:3,rowspan:b(l,"actions"),class:"text-center"},[k(s,{variant:"ghost",size:"small",onClick:u=>R(l)},{default:G(()=>e[16]||(e[16]=[t("i",{class:"icon icon-md icon-edit"},null,-1)])),_:2},1032,["onClick"])],8,_e)):c("",!0)],42,be))),128))])])])):H.value?c("",!0):(a(),i("table",Be,[e[26]||(e[26]=t("colgroup",null,[t("col",{style:{width:"40px"}}),t("col",{style:{width:"200px"}}),t("col",{style:{width:"100px"}}),t("col",{style:{width:"auto"}}),t("col",{style:{width:"100px"}}),t("col",{style:{width:"100px"}}),t("col",{style:{width:"40px"}})],-1)),t("thead",Te,[t("tr",null,[t("th",null,[k(o,{size:"large",modelValue:_.value,"onUpdate:modelValue":A},null,8,["modelValue"])]),e[18]||(e[18]=t("th",null,"역량정의/역량항목",-1)),e[19]||(e[19]=t("th",null,"구분",-1)),e[20]||(e[20]=t("th",null,"행동기준/행동수준/역량정의",-1)),e[21]||(e[21]=t("th",null,"수준/점수",-1)),e[22]||(e[22]=t("th",null,"가중",-1)),e[23]||(e[23]=t("th",null,"수정",-1))])]),t("tbody",null,[(a(!0),i(F,null,J(v.value,(l,x)=>(a(),i("tr",{key:l.uniqueKey,class:V(K(l)),draggable:S(l),onDragstart:u=>$(u,x,l),onDragover:j,onDrop:u=>L(u,x),onDragend:M,onClick:u=>U(l,u)},[h(l,"checkbox")?(a(),i("td",{key:0,rowspan:b(l,"checkbox"),class:"text-center"},[k(o,{size:"large",modelValue:B(l),"onUpdate:modelValue":()=>T(l),onClick:e[1]||(e[1]=P(()=>{},["stop"]))},null,8,["modelValue","onUpdate:modelValue"])],8,ze)):c("",!0),h(l,"definition")?(a(),i("td",{key:1,rowspan:b(l,"definition"),class:"vertical-middle"},[l.type==="group-header"?(a(),i("div",Ke,[t("strong",null,"["+r(l.competencyName)+"]",1),e[24]||(e[24]=t("br",null,null,-1)),C(" "+r(l.definition),1)])):(a(),i("div",Ee,[t("span",{class:V(["category-badge",E(l.category)])},r(l.category),3)]))],8,He)):c("",!0),h(l,"type")?(a(),i("td",{key:2,rowspan:b(l,"type"),class:"text-center"},r(l.categoryType),9,Ae)):c("",!0),t("td",Ne,[t("div",{class:V(l.type==="group-item"?"behavior-group":"behavior-single")},r(l.behavior),3)]),t("td",Re,r(l.level),1),t("td",Ue,r(l.weight),1),h(l,"actions")?(a(),i("td",{key:3,rowspan:b(l,"actions"),class:"text-center"},[k(s,{variant:"ghost",size:"small",onClick:u=>R(l)},{default:G(()=>e[25]||(e[25]=[t("i",{class:"icon icon-md icon-edit"},null,-1)])),_:2},1032,["onClick"])],8,$e)):c("",!0)],42,qe))),128))])]))],6)}}},Je=ee(je,[["__scopeId","data-v-fb62d064"]]);export{Je as default};
